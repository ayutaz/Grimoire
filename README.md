# Grimoire - 純粋記号プログラミング言語

> 「すべてのプログラムは魔法陣である」

Grimoireは、文字を一切使わず、純粋に記号と図形のみでプログラムを表現する実験的なビジュアルプログラミング言語です。手描きの魔法陣を画像認識によってコンパイルし、実行可能なプログラムを作成します。

![Build Status](https://github.com/ayutaz/Grimoire/actions/workflows/build-binaries.yml/badge.svg)
![Test Status](https://github.com/ayutaz/Grimoire/actions/workflows/test.yml/badge.svg)
![Coverage](https://img.shields.io/badge/coverage-82.88%25-brightgreen)

## 🌟 特徴

- **魔法陣パラダイム**: すべてのプログラムは外周円を持つ魔法陣として表現
- **完全記号化**: 文字を使わない純粋なビジュアル表現
- **画像認識**: 手描きまたはデジタル画像を実行可能プログラムにコンパイル
- **直感的な記号体系**: 図形とパターンで全てを表現
- **空間的プログラミング**: 図形の配置と接続でフローを制御
- **決定的な認識**: OpenCVの古典的コンピュータビジョン技術により、同じ入力に対して常に同じ結果を保証

## 📐 基本記号

### 構造要素
- `◎` - メインエントリポイント
- `○` - 関数/スコープ
- `□` - 変数/データ
- `△` - 条件分岐
- `⬟` - ループ
- `⬢` - 並列処理
- `☆` - 出力/表示

### データ型（図形内パターン）
- `•` - 整数型
- `••` - 浮動小数点型
- `≡` - 文字列型
- `◐` - ブール型
- `※` - 配列型
- `⊞` - マップ型

### 数値表現
- `•` = 1, `••` = 2, `•••` = 3
- `⦿` = 10, `⊡` = 100, `⊙` = 1000

### 演算記号（魔法陣的表現）
- `⟐` - 結合/加算（エネルギーの収束）
- `⟑` - 分離/減算（エネルギーの分岐）
- `✦` - 増幅/乗算（4点星による力の増幅）
- `⟠` - 分割/除算（8分割円による分配）

## 📚 ドキュメント

- [言語仕様](docs/language-spec-ja.md)
- [コンパイラアーキテクチャ](docs/compiler-spec-ja.md)
- [チュートリアル](docs/tutorial-ja.md)
- [実装ガイド](docs/implementation-guide-ja.md)
- [サンプル集](examples/)
- [テスト戦略](docs/TEST_STRATEGY.md)

## 🚀 インストール

### バイナリ配布（推奨）

[Releases](https://github.com/ayutaz/Grimoire/releases)から、お使いのプラットフォーム用のバイナリをダウンロードしてください。

### ソースからのインストール

#### Go版（開発中）

```bash
# Go 1.21以上が必要
go install github.com/ayutaz/grimoire/cmd/grimoire@latest

# または、リポジトリをクローンしてビルド
git clone https://github.com/ayutaz/Grimoire.git
cd Grimoire
go build -o grimoire cmd/grimoire/main.go
```

#### Python版（安定版）

```bash
# uvを使用（推奨）
pip install uv
uv sync

# または従来のpip
pip install -e .
```

## 🎨 使い方

### 1. 魔法陣を描く

紙に手描き、またはデジタルツールで魔法陣を作成します。必ず外周円で囲んでください。

### 2. 画像をコンパイル・実行

⚠️ **重要**: Windows環境では、ファイル名に日本語や特殊文字を使用しないでください。英数字とアンダースコア、ハイフンのみを使用してください。

```bash
# ✅ 良い例
grimoire run hello_world.png
grimoire run my-magic-circle.png

# ❌ 避けるべき例
grimoire run 魔法陣.png
grimoire run こんにちは.png
```

```bash
# 直接実行
grimoire run magic_circle.png

# Pythonコードに変換
grimoire compile magic_circle.png -o output.py

# デバッグモード
grimoire debug magic_circle.png
```

## 📝 プログラム例

### Hello World (シンプルな出力)

```
      ╭─────────╮
    ╱             ╲
   │       ◎       │   <- メインエントリ
   │       |       │
   │       ☆       │   <- 出力
    ╲             ╱
      ╰─────────╯
```

### 加算 (1 + 2)

```
      ╭─────────────╮
    ╱                 ╲
   │         ◎         │
   │      ╱  |  ╲      │
   │    □    □    □    │  <- □(•) + □(••) 
   │    •    ⟐   ••    │  <- 1 + 2
   │         |         │
   │         ☆         │  <- 出力: 3
    ╲                 ╱
      ╰─────────────╯
```

### ループ (3回繰り返し)

```
      ╭────────────────╮
    ╱                    ╲
   │          ◎          │
   │          |          │
   │      □(•••)         │  <- カウンタ: 3
   │          |          │
   │      ╱───⬟───╲      │  <- ループ
   │     │    ☆    │     │  <- ループ内で出力
   │      ╲───────╱      │
    ╲                    ╱
      ╰────────────────╯
```

## 🧪 開発

### テストの実行

```bash
# 全テストを実行
uv run pytest

# カバレッジ付き
uv run pytest --cov=grimoire

# 特定のテストのみ
uv run pytest tests/unit/
```

### コードフォーマット

```bash
uv run ruff format .
uv run ruff check .
```

### ビルド

```bash
# スタンドアロン実行ファイルの作成
uv run pyinstaller grimoire.spec
```

## 🔧 技術詳細

### Go言語への移行

パフォーマンス向上のため、コア実装をPythonからGo言語に移行中です：

**移行による改善:**
- **起動時間**: 14.9秒 → 0.06秒（約250倍高速化）
- **実行時間**: 3秒 → 0.2秒（約15倍高速化）  
- **バイナリサイズ**: 80MB → 10MB（約8分の1）
- **依存関係**: OpenCV不要（Pure Go実装）

### 画像認識アプローチ

Go版では外部ライブラリに依存しない、Pure Goでの画像処理を実装：

- **輪郭検出**: Moore近傍探索による輪郭追跡
- **図形認識**: Douglas-Peuckerアルゴリズムによる多角形近似
- **前処理**: Gaussianブラー、適応的二値化、モルフォロジー演算
- **パターン認識**: 図形内部のドット、ライン、クロスパターンの検出

機械学習を使用しないことで、以下の利点があります：
- 決定的な結果（同じ入力→同じ出力）
- 高速な処理（GPUやモデル不要）
- 軽量な実装（数MB程度）
- 完全な説明可能性

## 📋 既知の問題

### Go版の制限事項
- 四角形の検出精度が不安定（円として誤検出される場合がある）
- 斜めの接続線の検出が未実装
- 複雑な演算子記号の認識が不完全

### Windows環境での制限
- 日本語や特殊文字を含むファイル名は使用できません（Python版）
- Go版では日本語ファイル名も処理可能

### その他
- 複雑なプログラムの解析には制限があります
- ループ内に実行内容がない場合、エラーになります

## 🤝 貢献

プルリクエストを歓迎します！以下のガイドラインに従ってください：

1. テストファースト（TDD）で開発
2. すべてのテストがパスすることを確認
3. カバレッジ80%以上を維持
4. コミットメッセージは日本語可

## 📄 ライセンス

このプロジェクトはMITライセンスのもとで公開されています。

## 🏰 哲学

Grimoireは、プログラミングを視覚的で直感的なものにすることを目指しています。文字という抽象的な記号体系から離れ、より原始的で普遍的な図形言語によって、プログラミングの本質を探求します。

すべてのプログラムは魔法陣です。そして、すべての魔法陣は意図と構造を持った芸術作品です。