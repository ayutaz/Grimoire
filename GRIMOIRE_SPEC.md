# Grimoire言語仕様書 統合版

## 1. 言語概要

Grimoireは、手描きの魔法陣を実行可能プログラムに変換するビジュアルプログラミング言語です。文字を一切使用せず、純粋に記号の組み合わせで全てを表現します。

### 特徴
- 画像認識によるコンパイル
- 記号のみによる完全ビジュアル言語
- 空間的なプログラムフロー
- 直感的なデバッグ支援
- **すべてのプログラムは外周円を持つ魔法陣として表現される**

## 1.1 魔法陣の必須要件

**重要**: すべてのGrimoireプログラムは、外側に円を持つ魔法陣でなければなりません。外周円がない場合は、コンパイルエラーとなります。

```
エラー: 外周円が検出されません。
すべてのGrimoireプログラムは魔法陣（外周円）の内部に記述される必要があります。
```

### 有効な魔法陣の例
```
     ╱─────╲      <- 外周円（必須）
   ╱         ╲
  │     ◎     │    <- プログラム要素は内部に配置
   ╲         ╱
     ╲─────╱
```

### 無効な例（コンパイルエラー）
```
    ◎           <- 外周円なし：エラー
    │
    ☆
```

## 2. 基本図形と意味

### 2.1 構造要素

| 図形 | シンボル | 意味 |
|------|----------|------|
| 円 | ○ | スコープ/関数 |
| 二重円 | ◎ | メインエントリ |
| 四角 | □ | データ/変数 |
| 三角 | △ | 判定/分岐 |
| 五角形 | ⬟ | ループ/反復 |
| 六角形 | ⬢ | 並列/非同期 |
| 八角形 | ⯃ | クラス/構造体 |

**注意**: これらの要素はすべて外周円の内部に配置される必要があります。

### 2.2 演算記号（魔法陣内での表現）

演算は図形の配置と接続パターンで表現：

| パターン | 意味 | 説明 |
|----------|------|------|
| ⟐ | 加算/結合 | 2つの要素が1つに収束 |
| ⟑ | 減算/分離 | 1つから分岐 |
| ✦ | 乗算/増幅 | 4点星（力の増幅） |
| ⟠ | 除算/分割 | 分割を表す8分割円 |
| ⟷ | 交換/代入 | 双方向の流れ |
| ⊗ | 否定/反転 | 打ち消しの印 |
| ⟳ | 循環/ループ | 円形の矢印 |

### 2.3 データ型記号

型は図形の内部パターンで表現：

| パターン | 型 | 説明 |
|----------|-----|------|
| • | 整数 | 単一の点 |
| •• | 浮動小数点 | 二重点 |
| ≡ | 文字列 | 三本線 |
| ◐ | ブール | 半円 |
| ※ | 配列 | 星形配置の点 |
| ⊞ | マップ | グリッドパターン |
| ∅ | null/void | 空集合 |

## 3. 値の表現

### 3.1 数値
数値は点の数と配置で表現：

| パターン | 値 |
|----------|-----|
| • | 1 |
| •• | 2 |
| ••• | 3 |
| •⁴ | 4（上付き表記）|
| •⁵ | 5 |
| ⦿ | 10（囲み点）|
| ⦿• | 11 |
| ⦿⦿ | 20 |
| ⊡ | 100（二重囲み）|
| ⊙ | 1000（三重囲み）|

### 3.2 特殊記号
よく使う機能は特殊記号で表現：

| 記号 | 意味 |
|------|------|
| ☆ | 出力/表示 |
| ★ | 入力/読み取り |
| ☀ | 開始/起動 |
| ☾ | 終了/停止 |
| ♪ | 音/サウンド |
| ✉ | メッセージ |
| ⚡ | エラー |
| ✓ | 成功 |
| ✗ | 失敗 |

## 4. 制御フロー

### 4.1 線の種類と意味

| 線種 | 意味 | 用途 |
|------|------|------|
| ─ | 通常のフロー | 標準的な実行順序 |
| ┈ | 条件付きフロー | 条件が真の場合 |
| ╌ | 代替フロー | 条件が偽の場合 |
| ～ | 例外フロー | エラー処理 |
| ═ | 同期フロー | 排他制御 |
| ⟷ | 双方向フロー | 相互作用 |

### 4.2 接続点記号

| 記号 | 意味 |
|------|------|
| → | 入力 |
| ← | 出力 |
| ↔ | 入出力 |
| ⊸ | 消費（移動）|
| ⟲ | ループバック |

## 5. プログラム例

### 5.1 Hello World相当（画面に星を表示）
```
     ╱─────╲
   ╱    ◎   ╲    <- 外周円内にメインエントリ
  │     │     │
  │     ☆     │   <- 星を表示
   ╲         ╱
     ╲─────╱
```

### 5.2 条件分岐（値の大小判定）
```
     ╱─────────╲
   ╱     □•⁵    ╲
  │      │       │
  │      △       │
  │     ╱ ╲      │
  │    ☀   ☾     │
   ╲             ╱
     ╲─────────╱
```

### 5.3 ループ（10回繰り返し）
```
     ╱─────────╲
   ╱    □⦿     ╲
  │      │       │
  │      ⬟       │
  │      │       │
  │      ☆       │
  │      │       │
  │      ⟲       │
   ╲             ╱
     ╲─────────╱
```

### 5.4 演算（加算の魔法陣）
```
     ╱──────────╲
   ╱   □•⦿      ╲   <- 第一の値
  │       ╲      │
  │        ⟐     │   <- 結合/加算の印
  │       ╱      │
  │   □•⦿⦿      │   <- 第二の値
  │       │      │
  │       ☆      │   <- 結果を表示
   ╲            ╱
     ╲────────╱
```

### 5.5 並列処理
```
     ╱────────────╲
   ╱       ⬢       ╲
  │     ╱│╲       │
  │    ╱ │ ╲      │
  │   ○  ○  ○     │
  │   │  │  │     │
  │   ☆  ♪  ✉     │
  │    ╲ │ ╱      │
  │     ╲│╱       │
  │       ⬢        │
   ╲              ╱
     ╲──────────╱
```

## 6. 高度な構造

### 6.1 クラス定義
```
     ╱──────────╲
   ╱      ⯃      ╲
  │  ├─ □•       │
  │  ├─ □••      │
  │  ├─ ○        │
  │  └─ ○        │
   ╲            ╱
     ╲────────╱
```

### 6.2 エラー処理
```
     ╱──────────╲
   ╱      ○      ╲
  │      │       │
  │    ～～～    │
  │      │       │
  │      ⚡      │
  │      │       │
  │      ○       │
   ╲            ╱
     ╲────────╱
```

### 6.3 デバッグマーカー

| 記号 | 意味 |
|------|------|
| 👁 | ウォッチポイント |
| 🐛 | ブレークポイント |
| 📍 | アサーション |
| 🔍 | トレースポイント |

## 7. 魔法陣の構成原則

### 7.1 力の流れ
- エネルギーは上から下、または中心から外側へ流れる
- 循環する力は時計回りが基本
- 反時計回りは解放や逆転を意味する

### 7.2 配置の意味
- **中心**: 最も重要な要素、主たる目的
- **上部**: 入力、源、始まり
- **下部**: 出力、結果、終わり
- **左側**: 過去、条件、前提
- **右側**: 未来、結果、帰結

### 7.3 対称性
- 対称的な配置は安定と調和を表す
- 非対称な配置は動的な処理や変化を表す
- 螺旋状の配置は反復や成長を表す

## 8. メタ情報

画像の四隅に配置する制御記号：

| 位置 | 記号例 | 意味 |
|------|--------|------|
| 左上 | ▲ | デバッグモード |
| 右上 | ● | リリースモード |
| 左下 | ■ | プラットフォーム指定 |
| 右下 | ♦ | 最適化レベル |

## 9. 実行

```bash
# コンパイル
grimoire compile magic.png -o magic.exe

# 実行
grimoire run magic.png

# デバッグ
grimoire debug magic.png
```

## 10. ファイル形式

- `.grim`: ソース画像
- `.grim.ast`: AST中間表現
- `.grim.debug`: デバッグ情報
- `.grim.map`: ソースマップ

## 11. コンパイルエラー

### 外周円エラー
```
Error: No outer circle detected.
All Grimoire programs must be written as magic circles with an outer boundary.
```

### その他のエラー
- 不完全な図形
- 接続されていない要素
- 型の不一致
- 未定義の記号

---

*"Draw Your Symbols, Cast Your Spells"*