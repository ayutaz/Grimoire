# Grimoire言語仕様書 統合版

## 1. 言語概要

Grimoireは、手描きの魔法陣を実行可能プログラムに変換するビジュアルプログラミング言語です。

### 特徴
- 画像認識によるコンパイル
- 幾何学図形による意味表現
- 空間的なプログラムフロー
- 直感的なデバッグ支援

## 2. 基本図形と意味

| 図形 | シンボル | 意味 | 例 |
|------|----------|------|-----|
| 円 | ○ | スコープ/関数 | `○ function_name()` |
| 二重円 | ◎ | メインエントリ | `◎ main` |
| 四角 | □ | データ/変数 | `□ #x = 42` |
| 三角 | △ | 判定/分岐 | `△ (condition)` |
| 五角形 | ⬟ | ループ/反復 | `⬟ (5)` または `⬟ (∞)` |
| 六角形 | ⬢ | 並列/非同期 | `⬢ parallel` |
| 星(5点) | ☆ | 入出力 | `☆ "output"` |
| 星(6点) | ✡ | ネットワーク | `✡ http.get()` |

## 3. 型システム

変数の型は図形内の記号で表現：

| 記号 | 型 | 例 |
|------|-----|-----|
| # | 整数 | `□ #age = 25` |
| ~ | 浮動小数点 | `□ ~pi = 3.14` |
| $ | 文字列 | `□ $name = "Alice"` |
| ? | ブール | `□ ?flag = true` |
| @ | 参照 | `□ @ptr` |
| [] | 配列 | `□ []nums = [1,2,3]` |
| {} | マップ | `□ {}dict` |

## 4. 線の種類と意味

| 線種 | 意味 | 用途 |
|------|------|------|
| 実線 | 通常のフロー | 標準的な実行順序 |
| 破線 | オプショナル | Nullable/条件付き実行 |
| 波線 | 例外可能性 | エラーを投げる可能性 |
| 点線 | 弱い参照 | ウィークポインタ |
| 二重線 | 保護/同期 | 不変/ミューテックス |
| 太線 | ホットパス | 最適化ヒント |
| 細線 | コールドパス | 低優先度 |

## 5. プログラム例

### Hello World
```
    ◎
    |
    ☆
    |
"Hello World"
```

### 条件分岐
```
    △ (x > 10)
   / \
  /   \
 ☆     ☆
"大"   "小"
```

### ループ
```
⬟ (i = 1..10)
|
☆ i
```

### 関数定義
```
○ add(#a, #b)
├─ □ #sum = a + b
└─ ☆ sum
```

### 並列処理
```
    ⬢
   /|\
  / | \
 ○  ○  ○
 f1 f2 f3
  \ | /
   \|/
    ⬢
```

## 6. 特殊記法

### 定数
```
□ #MAX
• = 100
```
中心の点`•`が定数を示す

### エラー処理
```
○ (try)
|
~~~~ risky()
|
○! (catch)
```

### デバッグ
- 👁: ウォッチポイント
- 🐛: ブレークポイント
- 📍: アサーション

## 7. コンパイル指示

画像の四隅：
- 左上: バージョン
- 右上: 最適化レベル
- 左下: ターゲット
- 右下: デバッグ情報

## 8. 実行

```bash
# コンパイル
grimoire compile magic.png -o magic.exe

# 実行
grimoire run magic.png

# デバッグ
grimoire debug magic.png
```

## 9. ファイル形式

- `.grim`: ソース画像
- `.grim.ast`: AST中間表現
- `.grim.debug`: デバッグ情報
- `.grim.map`: ソースマップ

---

*"Draw Your Logic, Run Your Magic"*