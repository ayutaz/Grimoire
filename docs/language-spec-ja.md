# Grimoire言語仕様 v2.0

## 目次
1. [はじめに](#introduction)
2. [基本図形とその意味](#basic-shapes)
3. [記号システム](#symbol-system)
4. [プログラム構造](#program-structure)
5. [データ表現](#data-representation)
6. [制御フロー](#control-flow)
7. [関数とスコープ](#functions-scope)
8. [エラー処理](#error-handling)
9. [高度な機能](#advanced-features)

## はじめに {#introduction}

Grimoireは、手描きの魔法陣としてプログラムを表現する純粋なビジュアルプログラミング言語です。文字を一切使用せず、幾何学図形と記号の組み合わせのみで全てを表現します。

### 基本原則
- **完全記号化**: 文字を使わない純粋なビジュアル表現
- **空間的プログラミング**: 位置と接続が実行フローを決定
- **図形の意味論**: 各図形には固有の意味がある
- **シンボルの密度**: 複雑な操作をコンパクトなシンボルで表現

## 基本図形とその意味 {#basic-shapes}

### 構造要素

| 図形 | シンボル | 意味 |
|------|----------|------|
| 円 | ○ | スコープ/関数 |
| 二重円 | ◎ | メインエントリ |
| 四角 | □ | データ/変数 |
| 三角 | △ | 判定/分岐 |
| 五角形 | ⬟ | ループ/反復 |
| 六角形 | ⬢ | 並列/非同期 |
| 八角形 | ⯃ | クラス/構造体 |

### 図形の修飾子

- **実線境界**: 通常の境界
- **二重境界線**: 保護/不変
- **破線境界**: オプショナル/Nullable
- **波線境界**: 遅延評価
- **点線境界**: 弱い参照
- **太線**: 重要/最適化対象
- **細線**: 低優先度

## 記号システム {#symbol-system}

### 演算子記号

| 記号 | 意味 |
|------|------|
| + | 加算/結合 |
| - | 減算/除去 |
| × | 乗算/繰り返し |
| ÷ | 除算/分割 |
| = | 代入/等価 |
| ≠ | 不等価 |
| < | 小なり |
| > | 大なり |
| ≤ | 以下 |
| ≥ | 以上 |
| ∧ | AND |
| ∨ | OR |
| ¬ | NOT |
| ⊕ | XOR |

### データ型記号

型は図形の内部パターンで表現：

| パターン | 型 | 説明 |
|----------|-----|------|
| • | 整数 | 単一の点 |
| •• | 浮動小数点 | 二重点 |
| ≡ | 文字列 | 三本線 |
| ◐ | ブール | 半円 |
| ※ | 配列 | 星形配置の点 |
| ⊞ | マップ | グリッドパターン |
| ∅ | null/void | 空集合 |

### 特殊機能記号

| 記号 | 意味 |
|------|------|
| ☆ | 出力/表示 |
| ★ | 入力/読み取り |
| ☀ | 開始/起動 |
| ☾ | 終了/停止 |
| ♪ | 音/サウンド |
| ✉ | メッセージ |
| ⚡ | エラー |
| ✓ | 成功 |
| ✗ | 失敗 |
| ∞ | 無限/無限ループ |
| λ | ラムダ/無名関数 |
| Σ | 総和/リデュース |
| ∫ | 積分/マップ |

## プログラム構造 {#program-structure}

### エントリーポイント
すべてのGrimoireプログラムには、二重円（◎）でマークされたメインエントリが必要です。

```
    ◎
    │
    ○
    │
    □
```

### 実行フロー
1. プログラムは◎から開始
2. 線の接続順序に従って実行
3. 分岐は△で制御
4. ループは⬟で表現

## データ表現 {#data-representation}

### 数値の表現

| パターン | 値 |
|----------|-----|
| • | 1 |
| •• | 2 |
| ••• | 3 |
| •⁴ | 4 |
| •⁵ | 5 |
| ⦿ | 10 |
| ⦿• | 11 |
| ⦿⦿ | 20 |
| ⊡ | 100 |
| ⊙ | 1000 |

### ブール値
- ◐ (半円塗りつぶし) = true
- ◯ (空の円) = false

### 配列/リスト
```
※
├─ •
├─ ••
└─ •••
```

### マップ/辞書
```
⊞
├─ [•] → [••]
└─ [•••] → [•⁴]
```

## 制御フロー {#control-flow}

### 線の種類と意味

| 線種 | 意味 | 用途 |
|------|------|------|
| ─ | 通常のフロー | 標準的な実行順序 |
| ┈ | 条件付きフロー | 条件が真の場合 |
| ╌ | 代替フロー | 条件が偽の場合 |
| ～ | 例外フロー | エラー処理 |
| ═ | 同期フロー | 排他制御 |
| ⟷ | 双方向フロー | 相互作用 |

### 接続点記号

| 記号 | 意味 |
|------|------|
| → | 入力 |
| ← | 出力 |
| ↔ | 入出力 |
| ⊸ | 消費（移動）|
| ⟲ | ループバック |

### 条件分岐
```
    △
   ╱ ╲
  ┈   ╌
 ╱     ╲
○       ○
```

### ループ構造
```
⬟ ← □⦿
│
○
│
⟲
```

### 並列処理
```
    ⬢
   ╱│╲
  ╱ │ ╲
 ○  ○  ○
  ╲ │ ╱
   ╲│╱
    ⬢
```

## 関数とスコープ {#functions-scope}

### 関数定義
```
○
├→ □• (パラメータ1)
├→ □•• (パラメータ2)
│
│ (処理)
│
←□ (戻り値)
```

### スコープルール
1. 内側の円は外側の円の変数にアクセス可能
2. 重なる円はスコープを共有
3. 点線の円境界はクロージャキャプチャを示す

### ラムダ関数
```
λ○
│
式
```

## エラー処理 {#error-handling}

### Try-Catchパターン
```
○
│
～～～
│
⚡
│
○
```

### エラータイプ
- ⚡ : 一般的なエラー
- ⚡⚡ : 致命的エラー
- ⚠ : 警告
- ⏱ : タイムアウト

## 高度な機能 {#advanced-features}

### クラス定義
```
⯃
├─ □• (プロパティ1)
├─ □•• (プロパティ2)
├─ ○ (メソッド1)
└─ ○ (メソッド2)
```

### メタプログラミング
図形を動的に生成する場合は、図形を二重線で囲む：
```
╔═╗
║○║ (動的に円を生成)
╚═╝
```

### デバッグマーカー

| 記号 | 意味 |
|------|------|
| 👁 | ウォッチポイント |
| 🐛 | ブレークポイント |
| 📍 | アサーション |
| 🔍 | トレースポイント |

### メタ情報
画像の四隅に配置する制御記号：

| 位置 | 記号例 | 意味 |
|------|--------|------|
| 左上 | ▲ | デバッグモード |
| 右上 | ● | リリースモード |
| 左下 | ■ | プラットフォーム指定 |
| 右下 | ♦ | 最適化レベル |

## ファイル形式

Grimoireファイルは`.grim`拡張子を使用し、以下の形式が可能：
1. **PNG/JPG**: スキャンまたはデジタル描画
2. **SVG**: 正確な図形のためのベクター形式
3. **GRIM**: バイナリコンパイル形式

## 実行コマンド

```bash
# コンパイル
grimoire compile magic.png -o magic.exe

# 実行
grimoire run magic.png

# デバッグ
grimoire debug magic.png
```

---

*この仕様は言語の進化に伴い変更される可能性があります。*