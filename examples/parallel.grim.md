# 並列処理の例

## 基本的な並列実行

```
◎
└─ ⬢
   ├─ ○
   │  └─ ☆
   ├─ ○
   │  └─ ♪
   └─ ○
      └─ ✉
   │
   └─⬢─→ ✓
```

## MapReduce パターン

```
◎
├─ □※
│  ├─ •
│  ├─ ••
│  ├─ •••
│  └─ •⁴
│
├─ ⬢
│  ├─ λ○ → ×
│  └─ □※
│  │
│  └─⬢─→ □※
│
└─ ⬢
   ├─ λ○ → +
   └─ □※
   │
   └─⬢─→ ☆
```

## 同期付き並列処理

```
◎
├─ □• = ∅
├─ ═══════  ← 同期プリミティブ
│
└─ ⬢ ⦿
   └─ ⬟ ⊡  ← 各ワーカーが100回ループ
      └─ ╔═══╗
         ║ ↔ ║
         ╚═╤═╝
           │
         □• +
           │
         ╔═╧═╗
         ║ ← ║
         ╚═══╝
```

## Producer-Consumer パターン

```
○
└─ ⬟ ∞
   ├─ □
   └─ ⊸  ← キューに追加

○
└─ ⬟ ∞
   ├─ ← □  ← キューから取得
   └─ ☆

◎
└─ ⬢
   ├─ ○ ×••  ← 2つのプロデューサー
   ├─ ═══════  ← 共有キュー
   └─ ○ ×•⁴  ← 4つのコンシューマー
```

## 非同期待機

```
◎
├─ ⬢
│  ├─ ○ → □•
│  ├─ ○ → □※
│  └─ ○ → □⊞
│  │
│  └─⬢─→ ⟷
│         │
└─────────→ ☆
```

## 解説

### 並列実行シンボル
- `⬢`: 六角形は並列実行を開始
- 上部の六角形: タスクを分散
- 下部の六角形: 結果を収集（バリア同期）

### 同期プリミティブ
- `═══`: 太い二重線はミューテックスやロック
- `⊸`: 一方向のデータ移動（キューへの追加）
- `←`: データの取得
- `↔`: 双方向アクセス（ロック取得）
- `⟷`: 全体の同期待機

### 数値表現
- `×••`: 2倍（2つのインスタンス）
- `×•⁴`: 4倍（4つのインスタンス）
- `⦿`: 10
- `⊡`: 100
- `∞`: 無限

### パターン
1. **Fire and Forget**: 結果を待たない並列実行
2. **Fork-Join**: 分散して結果を収集
3. **Pipeline**: ステージ間でデータを流す
4. **Worker Pool**: 固定数のワーカーでタスク処理

## 実行時の挙動

コンパイラは六角形を認識すると：
1. スレッドプールまたはgoroutineを生成
2. 各分岐を並列実行
3. 必要に応じて同期を挿入
4. 結果を収集して続行